<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/style.css" />
    <title>Pizza List</title>
  </head>
  <body>
    <h1>Pizza List</h1>
    <div id="allergen-filters">
      <h2>Allergen Filters:</h2>
      <div id="allergen-checkboxes"></div>
    </div>
    <div id="pizza-list">
      <h2>Pizzas:</h2>
      <ul id="pizzas"></ul>
    </div>

    <script>
      const allergenCheckboxes = document.getElementById('allergen-checkboxes');
      const pizzaList = document.getElementById('pizzas');

      async function fetchData(url) {
        const response = await fetch(url);
        return response.json();
      }

      function displayAllergens(allergens) {
        allergens.forEach((allergen) => {
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `allergen-${allergen.id}`;
          checkbox.dataset.allergenId = allergen.id;

          const label = document.createElement('label');
          label.htmlFor = `allergen-${allergen.id}`;
          label.textContent = allergen.name;

          allergenCheckboxes.appendChild(checkbox);
          allergenCheckboxes.appendChild(label);
        });
      }

      function displayPizzas(pizzas) {
        pizzaList.innerHTML = '';
        pizzas.forEach((pizza) => {
          const listItem = document.createElement('li');
          listItem.textContent = `${pizza.name} - ${pizza.ingredients.join(', ')}`;
          pizzaList.appendChild(listItem);
        });
      }

      async function loadPizzasAndAllergens() {
        const [pizzas, allergens] = await Promise.all([
          fetchData('/api/pizza'),
          fetchData('/api/allergen'),
        ]);

        displayAllergens(allergens);
        displayPizzas(pizzas);

        allergenCheckboxes.addEventListener('change', () => {
          const checkedAllergens = Array.from(
            allergenCheckboxes.querySelectorAll('input:checked')
          ).map((checkbox) => parseInt(checkbox.dataset.allergenId));

          const filteredPizzas = pizzas.filter((pizza) => {
            return checkedAllergens.every((allergenId) => !pizza.allergens.includes(allergenId));
          });

          displayPizzas(filteredPizzas);
        });
      }

      loadPizzasAndAllergens();
    </script>
  </body>
</html>
